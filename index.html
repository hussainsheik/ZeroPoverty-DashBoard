<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secretariat Data Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css">
    <style>
        :root {
            --primary: #00f7ff;
            --secondary: #ff00e4;
            --dark: #0a0a1a;
            --darker: #050510;
            --light: #e0e0ff;
            --accent: #7b2dff;
            --success: #00ff9d;
            --warning: #ffd700;
            --danger: #ff3860;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark);
            color: var(--light);
            overflow-x: hidden;
            line-height: 1.6;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background-color: var(--darker);
            padding: 2rem 1rem;
            border-right: 1px solid rgba(0, 247, 255, 0.1);
            box-shadow: 0 0 20px rgba(0, 247, 255, 0.05);
            position: relative;
            z-index: 10;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            box-shadow: 0 0 10px var(--primary);
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 2rem;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 247, 255, 0.5);
            letter-spacing: 2px;
        }

        .filter-section {
            margin-bottom: 2rem;
        }

        .filter-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
        }

        .filter-title::before {
            content: '‚èµ';
            margin-right: 0.5rem;
            font-size: 0.8rem;
            color: var(--secondary);
        }

        select {
            width: 100%;
            padding: 0.5rem;
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--primary);
            color: var(--light);
            border-radius: 4px;
            font-family: 'Roboto', sans-serif;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 10px rgba(0, 247, 255, 0.3);
        }

        .main-content {
            padding: 2rem;
            position: relative;
        }

        .main-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 30%, rgba(123, 45, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(0, 247, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(0, 247, 255, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(10, 10, 26, 0.8), rgba(5, 5, 16, 0.9));
            border: 1px solid rgba(0, 247, 255, 0.1);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            border-color: rgba(0, 247, 255, 0.3);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-title {
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-weight: 300;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--light);
            margin-bottom: 0.5rem;
            font-family: 'Orbitron', sans-serif;
        }

        .stat-change {
            font-size: 0.8rem;
            color: var(--success);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: linear-gradient(135deg, rgba(10, 10, 26, 0.8), rgba(5, 5, 16, 0.9));
            border: 1px solid rgba(0, 247, 255, 0.1);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            border-color: rgba(0, 247, 255, 0.3);
        }

        .chart-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: var(--primary);
            margin-bottom: 1rem;
            text-align: center;
        }

        .map-container {
            height: 400px;
            background: linear-gradient(135deg, rgba(10, 10, 26, 0.8), rgba(5, 5, 16, 0.9));
            border: 1px solid rgba(0, 247, 255, 0.1);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
        }

        .map-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: var(--primary);
            margin-bottom: 1rem;
            text-align: center;
        }

        #map {
            height: 100%;
            width: 100%;
            border-radius: 4px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2rem;
            background: linear-gradient(135deg, rgba(10, 10, 26, 0.8), rgba(5, 5, 16, 0.9));
            border: 1px solid rgba(0, 247, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table th {
            background-color: rgba(0, 247, 255, 0.1);
            color: var(--primary);
            font-family: 'Orbitron', sans-serif;
            padding: 1rem;
            text-align: left;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-table td {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid rgba(0, 247, 255, 0.05);
            color: var(--light);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover {
            background-color: rgba(0, 247, 255, 0.05);
        }

        .glow {
            position: fixed;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 247, 255, 0.3) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
            animation: float 15s infinite ease-in-out;
        }

        .glow:nth-child(2) {
            background: radial-gradient(circle, rgba(255, 0, 228, 0.3) 0%, transparent 70%);
            animation-delay: 5s;
            animation-duration: 20s;
        }

        .glow:nth-child(3) {
            background: radial-gradient(circle, rgba(123, 45, 255, 0.3) 0%, transparent 70%);
            animation-delay: 10s;
            animation-duration: 25s;
        }

        @keyframes float {
            0%, 100% {
                transform: translate(0, 0);
            }
            25% {
                transform: translate(50vw, 30vh);
            }
            50% {
                transform: translate(30vw, 60vh);
            }
            75% {
                transform: translate(-20vw, 40vh);
            }
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(5, 5, 16, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-spinner::before,
        .loading-spinner::after {
            content: '';
            position: absolute;
            border: 3px solid transparent;
            border-radius: 50%;
        }

        .loading-spinner::before {
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border-top-color: var(--secondary);
            animation: spin 2s linear infinite;
        }

        .loading-spinner::after {
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border-top-color: var(--accent);
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            margin-top: 1rem;
            color: var(--primary);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                padding: 1rem;
                border-right: none;
                border-bottom: 1px solid rgba(0, 247, 255, 0.1);
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="glow"></div>
    <div class="glow"></div>
    <div class="glow"></div>

    <div class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">LOADING DATA</div>
    </div>

    <div class="dashboard">
        <div class="sidebar">
            <div class="logo">SECRETARIAT ANALYTICS</div>
            
            <div class="filter-section">
                <div class="filter-title">Mandal Filter</div>
                <select id="mandal-filter">
                    <option value="all">All Mandals</option>
                    <!-- Mandal options will be populated by JavaScript -->
                </select>
            </div>
            
            <div class="filter-section">
                <div class="filter-title">Secretariat Filter</div>
                <select id="secretariat-filter">
                    <option value="all">All Secretariats</option>
                    <!-- Secretariat options will be populated by JavaScript -->
                </select>
            </div>
            
            <div class="filter-section">
                <div class="filter-title">Data View</div>
                <select id="data-view">
                    <option value="overview">Overview</option>
                    <option value="families">Families Analysis</option>
                    <option value="adoption">Adoption Progress</option>
                    <option value="mobilization">Mobilization Metrics</option>
                </select>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1 class="title">SECRETARIAT PERFORMANCE DASHBOARD</h1>
                <div id="last-updated" style="color: var(--primary); font-family: 'Orbitron', sans-serif; font-size: 0.8rem;"></div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Total Secretariats</div>
                    <div class="stat-value" id="total-secretariats">0</div>
                    <div class="stat-change">Across all mandals</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Total Families</div>
                    <div class="stat-value" id="total-families">0</div>
                    <div class="stat-change">Registered families</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Total Members</div>
                    <div class="stat-value" id="total-members">0</div>
                    <div class="stat-change">Family members</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Adoption Rate</div>
                    <div class="stat-value" id="adoption-rate">0%</div>
                    <div class="stat-change">Of total families</div>
                </div>
            </div>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">FAMILIES DISTRIBUTION</div>
                    <canvas id="families-chart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">ADOPTION PROGRESS</div>
                    <canvas id="adoption-chart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">MOBILIZATION STATUS</div>
                    <canvas id="mobilization-chart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">SECRETARIAT PERFORMANCE</div>
                    <canvas id="performance-chart"></canvas>
                </div>
            </div>
            
            <div class="map-container">
                <div class="map-title">GEOGRAPHICAL DISTRIBUTION</div>
                <div id="map"></div>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Secretariat Name</th>
                        <th>Total Families</th>
                        <th>Total Members</th>
                        <th>Adopted</th>
                        <th>Yet to Adopt</th>
                        <th>Mobilized</th>
                    </tr>
                </thead>
                <tbody id="data-table-body">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Google Sheets URL and sheet name
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/14iegStGgs20yLRkPDpds1oms8aLhuSOFxm1aE-d7tEE/edit#gid=0';
        const SHEET_NAME = 'SecretariatData';
        
        // Mandal IDs mapping
        const MANDAL_IDS = {
            "Achanta (R)": "105_56_2024",
            "Penugonda (R)": "105_56_2025",
            "Penumantra (R)": "105_56_2026",
            "Poduru (R)": "105_56_2023",
            "Bhimavaram (R)": "105_59_2029",
            "Bhimavaram (U)": "105_59_1074",
            "Veeravasaram (R)": "105_59_2027",
            "Mogalturu (R)": "105_58_2019",
            "Narasapur (U)": "105_58_1077",
            "Narasapuram (R)": "105_58_2020",
            "Elamanchili (R)": "105_57_2021",
            "Palakol (R)": "105_57_2022",
            "Palakol (U)": "105_57_1079",
            "Poduru (R)": "105_57_2023",
            "Pentapadu (R)": "105_62_2038",
            "Tadepalligudem (R)": "105_62_2047",
            "Tadepalligudem (U)": "105_62_1080",
            "Attili (R)": "105_61_2033",
            "Iragavaram (R)": "105_61_2034",
            "Tanuku (R)": "105_61_2037",
            "Tanuku (U)": "105_61_1081",
            "Akiveedu (R)": "105_60_2031",
            "Akiveedu (U)": "105_60_101151",
            "Kalla (R)": "105_60_2030",
            "Palakoderu (R)": "105_60_2028",
            "Undi (R)": "105_60_2032",
            "Ganapavaram (R)": "105_63_2039"
        };
        
        // Reverse mapping for ID to Mandal name
        const ID_TO_MANDAL = {};
        for (const [mandal, id] of Object.entries(MANDAL_IDS)) {
            ID_TO_MANDAL[id] = mandal;
        }
        
        // Store the original data and filtered data
        let originalData = [];
        let filteredData = [];
        
        // Chart instances
        let familiesChart, adoptionChart, mobilizationChart, performanceChart;
        
        // Map instance
        let map;
        
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize map
            initMap();
            
            // Load data from Google Sheets
            loadData();
            
            // Set up event listeners for filters
            document.getElementById('mandal-filter').addEventListener('change', function() {
                filterData();
                updateSecretariatFilterOptions();
                updateDashboard();
            });
            
            document.getElementById('secretariat-filter').addEventListener('change', function() {
                filterData();
                updateDashboard();
            });
            
            document.getElementById('data-view').addEventListener('change', function() {
                updateCharts();
            });
        });
        
        function initMap() {
            // Initialize the map centered on West Godavari district
            map = L.map('map').setView([16.7, 81.6], 10);
            
            // Add tile layer (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18,
            }).addTo(map);
        }
        
        function loadData() {
            // In a real implementation, you would fetch data from Google Sheets
            // For security reasons, browsers don't allow direct access to Google Sheets
            // without proper CORS headers or using the Google Sheets API
            
            // This is a placeholder for the actual data loading implementation
            // In practice, you would need to:
            // 1. Publish the sheet to the web (File > Publish to the web)
            // 2. Use the published CSV URL to fetch the data
            // 3. Parse the CSV data
            
            // For demonstration, we'll use a mock data loading function
            // Replace this with actual data loading code for your published sheet
            fetchMockData();
            
            // Actual implementation would look something like this:
            /*
            const publishedUrl = 'https://docs.google.com/spreadsheets/d/e/YOUR_PUBLISHED_ID/pub?output=csv';
            
            fetch(publishedUrl)
                .then(response => response.text())
                .then(csvData => {
                    originalData = parseCSV(csvData);
                    filteredData = [...originalData];
                    
                    // Extract mandals from data
                    updateMandalFilterOptions();
                    updateSecretariatFilterOptions();
                    
                    // Update dashboard with all data
                    updateDashboard();
                    
                    // Hide loading screen
                    document.querySelector('.loading').style.display = 'none';
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    document.querySelector('.loading').style.display = 'none';
                    alert('Failed to load data. Please check the console for details.');
                });
            */
        }
        
        function fetchMockData() {
            // This is just for demonstration - in your actual implementation, remove this
            // and use the real data loading code above
            
            console.warn('Using mock data - replace with actual Google Sheets data loading');
            
            // Generate mock data that matches your structure
            const mockData = [];
            const mandals = Object.keys(MANDAL_IDS);
            
            mandals.forEach((mandal, mandalIndex) => {
                const mandalId = MANDAL_IDS[mandal];
                const secretariatCount = 3 + Math.floor(Math.random() * 5);
                
                for (let i = 1; i <= secretariatCount; i++) {
                    const totalFamilies = 50 + Math.floor(Math.random() * 200);
                    const totalMembers = totalFamilies * (3 + Math.random() * 2);
                    const totalAdopted = Math.floor(totalFamilies * (0.1 + Math.random() * 0.7));
                    const yetToAdopt = totalFamilies - totalAdopted;
                    const mobilized = Math.floor(totalMembers * (0.3 + Math.random() * 0.6));
                    
                    mockData.push({
                        ID: `${mandalId}_${i}`,
                        SecretariatName: `${mandal} Secretariat ${i}`,
                        TotalFamilies: totalFamilies,
                        TotalFamilyMembers: Math.floor(totalMembers),
                        TotalAdopted: totalAdopted,
                        TotalBangaruKutumbamYetToAdopt: yetToAdopt,
                        TotalMargadarsiMobilized: mobilized,
                        Mandal: mandal,
                        MandalID: mandalId
                    });
                }
            });
            
            originalData = mockData;
            filteredData = [...originalData];
            
            // Extract mandals from data
            updateMandalFilterOptions();
            updateSecretariatFilterOptions();
            
            // Update dashboard with all data
            updateDashboard();
            
            // Hide loading screen
            document.querySelector('.loading').style.display = 'none';
        }
        
        function parseCSV(csvData) {
            // Parse CSV data into an array of objects
            const lines = csvData.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length === headers.length) {
                    const entry = {};
                    headers.forEach((header, index) => {
                        entry[header] = values[index].trim();
                    });
                    
                    // Convert numeric fields
                    entry.TotalFamilies = parseInt(entry.TotalFamilies) || 0;
                    entry.TotalFamilyMembers = parseInt(entry.TotalFamilyMembers) || 0;
                    entry.TotalAdopted = parseInt(entry.TotalAdopted) || 0;
                    entry.TotalBangaruKutumbamYetToAdopt = parseInt(entry.TotalBangaruKutumbamYetToAdopt) || 0;
                    entry.TotalMargadarsiMobilized = parseInt(entry.TotalMargadarsiMobilized) || 0;
                    
                    // Extract mandal from ID
                    const idParts = entry.ID.split('_');
                    const mandalId = `${idParts[0]}_${idParts[1]}_${idParts[2]}`;
                    entry.Mandal = ID_TO_MANDAL[mandalId] || 'Unknown';
                    entry.MandalID = mandalId;
                    
                    data.push(entry);
                }
            }
            
            return data;
        }
        
        function updateMandalFilterOptions() {
            const mandalFilter = document.getElementById('mandal-filter');
            
            // Get unique mandals from data
            const mandals = [...new Set(originalData.map(item => item.Mandal))].sort();
            
            // Clear existing options (keeping "All Mandals")
            while (mandalFilter.options.length > 1) {
                mandalFilter.remove(1);
            }
            
            // Add new options
            mandals.forEach(mandal => {
                const option = document.createElement('option');
                option.value = mandal;
                option.textContent = mandal;
                mandalFilter.appendChild(option);
            });
        }
        
        function updateSecretariatFilterOptions() {
            const secretariatFilter = document.getElementById('secretariat-filter');
            const selectedMandal = document.getElementById('mandal-filter').value;
            
            // Clear existing options (keeping "All Secretariats")
            while (secretariatFilter.options.length > 1) {
                secretariatFilter.remove(1);
            }
            
            // Filter secretariats based on selected mandal
            let secretariats = [];
            
            if (selectedMandal === 'all') {
                secretariats = [...new Set(originalData.map(item => item.SecretariatName))];
            } else {
                secretariats = [...new Set(originalData
                    .filter(item => item.Mandal === selectedMandal)
                    .map(item => item.SecretariatName))];
            }
            
            // Sort and add options
            secretariats.sort().forEach(secretariat => {
                const option = document.createElement('option');
                option.value = secretariat;
                option.textContent = secretariat;
                secretariatFilter.appendChild(option);
            });
        }
        
        function filterData() {
            const selectedMandal = document.getElementById('mandal-filter').value;
            const selectedSecretariat = document.getElementById('secretariat-filter').value;
            
            filteredData = originalData.filter(item => {
                const mandalMatch = selectedMandal === 'all' || item.Mandal === selectedMandal;
                const secretariatMatch = selectedSecretariat === 'all' || item.SecretariatName === selectedSecretariat;
                return mandalMatch && secretariatMatch;
            });
        }
        
        function updateDashboard() {
            updateSummaryStats();
            updateDataTable();
            updateCharts();
            updateMap();
            
            // Update last updated time
            document.getElementById('last-updated').textContent = `Last Updated: ${new Date().toLocaleString()}`;
        }
        
        function updateSummaryStats() {
            if (filteredData.length === 0) return;
            
            // Calculate summary statistics
            const totalSecretariats = filteredData.length;
            const totalFamilies = filteredData.reduce((sum, item) => sum + item.TotalFamilies, 0);
            const totalMembers = filteredData.reduce((sum, item) => sum + item.TotalFamilyMembers, 0);
            const totalAdopted = filteredData.reduce((sum, item) => sum + item.TotalAdopted, 0);
            const adoptionRate = totalFamilies > 0 ? Math.round((totalAdopted / totalFamilies) * 100) : 0;
            
            // Update DOM elements
            document.getElementById('total-secretariats').textContent = totalSecretariats;
            document.getElementById('total-families').textContent = totalFamilies.toLocaleString();
            document.getElementById('total-members').textContent = totalMembers.toLocaleString();
            document.getElementById('adoption-rate').textContent = `${adoptionRate}%`;
        }
        
        function updateDataTable() {
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = '';
            
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${item.ID}</td>
                    <td>${item.SecretariatName}</td>
                    <td>${item.TotalFamilies.toLocaleString()}</td>
                    <td>${item.TotalFamilyMembers.toLocaleString()}</td>
                    <td>${item.TotalAdopted.toLocaleString()}</td>
                    <td>${item.TotalBangaruKutumbamYetToAdopt.toLocaleString()}</td>
                    <td>${item.TotalMargadarsiMobilized.toLocaleString()}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        function updateCharts() {
            const dataView = document.getElementById('data-view').value;
            
            switch (dataView) {
                case 'overview':
                    updateOverviewCharts();
                    break;
                case 'families':
                    updateFamiliesCharts();
                    break;
                case 'adoption':
                    updateAdoptionCharts();
                    break;
                case 'mobilization':
                    updateMobilizationCharts();
                    break;
                default:
                    updateOverviewCharts();
            }
        }
        
        function updateOverviewCharts() {
            // Group data by mandal for overview charts
            const mandalGroups = {};
            
            filteredData.forEach(item => {
                if (!mandalGroups[item.Mandal]) {
                    mandalGroups[item.Mandal] = {
                        TotalFamilies: 0,
                        TotalFamilyMembers: 0,
                        TotalAdopted: 0,
                        TotalBangaruKutumbamYetToAdopt: 0,
                        TotalMargadarsiMobilized: 0,
                        count: 0
                    };
                }
                
                mandalGroups[item.Mandal].TotalFamilies += item.TotalFamilies;
                mandalGroups[item.Mandal].TotalFamilyMembers += item.TotalFamilyMembers;
                mandalGroups[item.Mandal].TotalAdopted += item.TotalAdopted;
                mandalGroups[item.Mandal].TotalBangaruKutumbamYetToAdopt += item.TotalBangaruKutumbamYetToAdopt;
                mandalGroups[item.Mandal].TotalMargadarsiMobilized += item.TotalMargadarsiMobilized;
                mandalGroups[item.Mandal].count++;
            });
            
            const mandals = Object.keys(mandalGroups);
            const familiesData = mandals.map(mandal => mandalGroups[mandal].TotalFamilies);
            const adoptionData = mandals.map(mandal => mandalGroups[mandal].TotalAdopted);
            const yetToAdoptData = mandals.map(mandal => mandalGroups[mandal].TotalBangaruKutumbamYetToAdopt);
            const mobilizationData = mandals.map(mandal => mandalGroups[mandal].TotalMargadarsiMobilized);
            const avgMobilizationData = mandals.map(mandal => 
                Math.round(mandalGroups[mandal].TotalMargadarsiMobilized / mandalGroups[mandal].count)
            );
            
            // Families Distribution Chart (Bar)
            if (familiesChart) familiesChart.destroy();
            const familiesCtx = document.getElementById('families-chart').getContext('2d');
            familiesChart = new Chart(familiesCtx, {
                type: 'bar',
                data: {
                    labels: mandals,
                    datasets: [{
                        label: 'Total Families',
                        data: familiesData,
                        backgroundColor: 'rgba(0, 247, 255, 0.6)',
                        borderColor: 'rgba(0, 247, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
            
            // Adoption Progress Chart (Doughnut)
            if (adoptionChart) adoptionChart.destroy();
            const adoptionCtx = document.getElementById('adoption-chart').getContext('2d');
            adoptionChart = new Chart(adoptionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Adopted', 'Yet to Adopt'],
                    datasets: [{
                        data: [
                            mandalGroups[mandals[0]]?.TotalAdopted || 0,
                            mandalGroups[mandals[0]]?.TotalBangaruKutumbamYetToAdopt || 0
                        ],
                        backgroundColor: [
                            'rgba(0, 255, 157, 0.6)',
                            'rgba(255, 99, 132, 0.6)'
                        ],
                        borderColor: [
                            'rgba(0, 255, 157, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
            
            // Mobilization Status Chart (Line)
            if (mobilizationChart) mobilizationChart.destroy();
            const mobilizationCtx = document.getElementById('mobilization-chart').getContext('2d');
            mobilizationChart = new Chart(mobilizationCtx, {
                type: 'line',
                data: {
                    labels: mandals,
                    datasets: [{
                        label: 'Total Mobilized',
                        data: mobilizationData,
                        borderColor: 'rgba(255, 0, 228, 0.8)',
                        backgroundColor: 'rgba(255, 0, 228, 0.2)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
            
            // Secretariat Performance Chart (Radar)
            if (performanceChart) performanceChart.destroy();
            const performanceCtx = document.getElementById('performance-chart').getContext('2d');
            performanceChart = new Chart(performanceCtx, {
                type: 'radar',
                data: {
                    labels: ['Families', 'Members', 'Adopted', 'Yet to Adopt', 'Mobilized'],
                    datasets: mandals.map((mandal, index) => {
                        const colors = [
                            'rgba(0, 247, 255, 0.6)',
                            'rgba(123, 45, 255, 0.6)',
                            'rgba(255, 0, 228, 0.6)',
                            'rgba(0, 255, 157, 0.6)',
                            'rgba(255, 215, 0, 0.6)'
                        ];
                        
                        return {
                            label: mandal,
                            data: [
                                mandalGroups[mandal].TotalFamilies,
                                mandalGroups[mandal].TotalFamilyMembers,
                                mandalGroups[mandal].TotalAdopted,
                                mandalGroups[mandal].TotalBangaruKutumbamYetToAdopt,
                                mandalGroups[mandal].TotalMargadarsiMobilized
                            ],
                            backgroundColor: colors[index % colors.length].replace('0.6', '0.2'),
                            borderColor: colors[index % colors.length],
                            borderWidth: 1,
                            pointBackgroundColor: colors[index % colors.length]
                        };
                    })
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            ticks: {
                                backdropColor: 'rgba(0, 0, 0, 0)',
                                color: 'rgba(255, 255, 255, 0.5)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }
        
        function updateFamiliesCharts() {
            // Similar implementation for families-focused charts
            // Would show detailed breakdown of families data
        }
        
        function updateAdoptionCharts() {
            // Similar implementation for adoption-focused charts
            // Would show detailed breakdown of adoption data
        }
        
        function updateMobilizationCharts() {
            // Similar implementation for mobilization-focused charts
            // Would show detailed breakdown of mobilization data
        }
        
        function updateMap() {
            // Clear existing markers
            map.eachLayer(layer => {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });
            
            // Add markers for each secretariat
            filteredData.forEach(item => {
                // In a real implementation, you would have coordinates for each secretariat
                // For demo, we'll use random coordinates within West Godavari district
                const lat = 16.5 + Math.random() * 0.6;
                const lng = 81.2 + Math.random() * 0.8;
                
                const popupContent = `
                    <strong>${item.SecretariatName}</strong><br>
                    Mandal: ${item.Mandal}<br>
                    Families: ${item.TotalFamilies}<br>
                    Members: ${item.TotalFamilyMembers}<br>
                    Adopted: ${item.TotalAdopted}<br>
                    Yet to Adopt: ${item.TotalBangaruKutumbamYetToAdopt}<br>
                    Mobilized: ${item.TotalMargadarsiMobilized}
                `;
                
                L.marker([lat, lng])
                    .addTo(map)
                    .bindPopup(popupContent);
            });
            
            // Adjust map view to show all markers if there are any
            if (filteredData.length > 0) {
                const group = new L.featureGroup();
                filteredData.forEach(item => {
                    const lat = 16.5 + Math.random() * 0.6;
                    const lng = 81.2 + Math.random() * 0.8;
                    group.addLayer(L.marker([lat, lng]));
                });
                map.fitBounds(group.getBounds());
            }
        }
    </script>
</body>
</html>
